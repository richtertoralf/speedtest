# speedtest
use speedtest in terminal / Ubuntu 20.04

## Install
`sudo apt install speedtest-cli`  

for the evaluation of json files (jq - Command-line JSON processor)  
`sudo apt install jq`  

## Variants of use of speedtest
```
usage: speedtest [-h] [--no-download] [--no-upload] [--single] [--bytes]
                 [--share] [--simple] [--csv] [--csv-delimiter CSV_DELIMITER]
                 [--csv-header] [--json] [--list] [--server SERVER]
                 [--exclude EXCLUDE] [--mini MINI] [--source SOURCE]
                 [--timeout TIMEOUT] [--secure] [--no-pre-allocate]
                 [--version]

Command line interface for testing internet bandwidth using speedtest.net.
--------------------------------------------------------------------------
https://github.com/sivel/speedtest-cli

optional arguments:
  -h, --help            show this help message and exit
  --no-download         Do not perform download test
  --no-upload           Do not perform upload test
  --single              Only use a single connection instead of multiple. This
                        simulates a typical file transfer.
  --bytes               Display values in bytes instead of bits. Does not
                        affect the image generated by --share, nor output from
                        --json or --csv
  --share               Generate and provide a URL to the speedtest.net share
                        results image, not displayed with --csv
  --simple              Suppress verbose output, only show basic information
  --csv                 Suppress verbose output, only show basic information
                        in CSV format. Speeds listed in bit/s and not affected
                        by --bytes
  --csv-delimiter CSV_DELIMITER
                        Single character delimiter to use in CSV output.
                        Default ","
  --csv-header          Print CSV headers
  --json                Suppress verbose output, only show basic information
                        in JSON format. Speeds listed in bit/s and not
                        affected by --bytes
  --list                Display a list of speedtest.net servers sorted by
                        distance
  --server SERVER       Specify a server ID to test against. Can be supplied
                        multiple times
  --exclude EXCLUDE     Exclude a server from selection. Can be supplied
                        multiple times
  --mini MINI           URL of the Speedtest Mini server
  --source SOURCE       Source IP address to bind to
  --timeout TIMEOUT     HTTP timeout in seconds. Default 10
  --secure              Use HTTPS instead of HTTP when communicating with
                        speedtest.net operated servers
  --no-pre-allocate     Do not pre allocate upload data. Pre allocation is
                        enabled by default to improve upload performance. To
                        support systems with insufficient memory, use this
                        option to avoid a MemoryError
  --version             Show the version number and exit

```

## special examples for using speedtest with json and jq
```
--json                Suppress verbose output, only show basic information
                      in JSON format. Speeds listed in bit/s and not
                      affected by --bytes
```

**command**   
`speedtest --json | jq`  
**output**  
```
{
  "download": 19034824.127818905,
  "upload": 2471105.5628897827,
  "ping": 30.595,
  "server": {
    "url": "http://speedtest-rz.vsm.sh:8080/speedtest/upload.php",
    "lat": "53.6990",
    "lon": "10.7711",
    "name": "Ratzeburg",
    "country": "Germany",
    "cc": "DE",
    "sponsor": "Vereinigte Stadtwerke Media GmbH",
    "id": "44668",
    "host": "speedtest-rz.vsm.sh:8080",
    "d": 219.29588698158068,
    "latency": 30.595
  },
  "timestamp": "2021-12-01T11:22:13.163467Z",
  "bytes_sent": 3276800,
  "bytes_received": 24401392,
  "share": null,
  "client": {
    "ip": "109.40.241.181",
    "lat": "52.5353",
    "lon": "13.4245",
    "isp": "Vodafone Germany",
    "isprating": "3.7",
    "rating": "0",
    "ispdlavg": "0",
    "ispulavg": "0",
    "loggedin": "0",
    "country": "DE"
  }
}

```
### Select and display individual values

`speedtest --json | jq ' .upload, .download, .ping, .client.isp, .client.ip'`  
```
2986901.012604094
17078874.170151684
48.321
"Vodafone Germany"
"109.40.241.181"
```

### Select single values and read them into an array  

Why read into an array? With this you can perform the speed test once and then use the individual values for further actions.  

`readarray -t mySpeedTest <<<$( (speedtest --json | jq -r '.timestamp, .upload, .download, .ping, .client.isp, .client.ip') )`  

**output the array length:**  
`echo ${#mySpeedTest[@]}` 

**display array values:**  
`echo ${mySpeedTest[@]}`  

**output single values (e.g. timestamp):**  
`echo ${mySpeedTest[0]}`  

oder
```
pi@NanoPi-R1S-H3:~$ speedtest --json | jq -r '.download, .upload, .ping, .client.ip, .client.isp' > speed.info
pi@NanoPi-R1S-H3:~$ cat speed.info 
9366684.470115473
6495362.381082652
51.41
109.40.241.227
Vodafone Germany
pi@NanoPi-R1S-H3:~$ readarray speedInfo < speed.info
pi@NanoPi-R1S-H3:~$ echo ${speedInfo[*]}
9366684.470115473 6495362.381082652 51.41 109.40.241.227 Vodafone Germany
```
